# requirements.md — 機能要件・技術要件

## サービス概要

**サービス名（仮）**: 気候変動対策 実績データベース  
**ターゲットユーザー**: 一般市民（自分の自治体の取り組みを知りたい人）  
**二次ユーザー**: 行政職員・報道記者（他自治体との比較資料）

---

## 機能要件

### Phase 1 — MVP（東京都のみ）

#### 画面1: 国/都道府県選択ランディング
- [ ] 都道府県一覧をランキング形式で表示
- [ ] 各都道府県のペース達成率（色分け）を表示
- [ ] 都道府県をクリックで画面2へ遷移

#### 画面2: 都道府県ビュー
- [ ] 選択した都道府県の概要KPI（総排出量・削減率・実績ペース・必要ペース）
- [ ] 「必要ペース vs 実績ペース」の大型比較ウィジェット
- [ ] 排出量の軌道グラフ（実績・必要軌道・2030目標・2050目標）
- [ ] 都道府県内の自治体ランキングリスト（ペース達成率順）
- [ ] 自治体をクリックで画面3へ遷移

#### 画面3: 自治体詳細ビュー
- [ ] 自治体の基本情報（人口・面積・ゼロカーボン宣言有無）
- [ ] ペース分析ヒーローウィジェット
  - 実績ペース（%/年）
  - 2030目標に必要なペース（%/年）
  - ペース達成率（%）
  - 2030年時点での予想不足量
- [ ] 軌道グラフ（実績 + 必要軌道 + 2030/2050目標マーカー）
- [ ] KPIカード4枚（総排出量・一人あたり・偏差値・不足量）
- [ ] 部門別排出量推移（積み上げ棒グラフ）
- [ ] 部門別削減率（横棒グラフ）
- [ ] 近隣自治体ペース比較（棒グラフ）
- [ ] 偏差値スケールバー（同規模自治体内での相対位置）

### Phase 2 — 全国展開
- [ ] 47都道府県のデータ収集・投入
- [ ] 全国1,900自治体のデータ収集
- [ ] 日本地図ビュー（都道府県クリック）
- [ ] 自治体検索（全国）

### Phase 3 — 高度機能
- [ ] ゼロカーボン宣言データとの統合
- [ ] 宣言有無 × 削減実績のマトリクス表示
- [ ] CSVダウンロード機能
- [ ] OGP画像生成（自治体カード）
- [ ] 都道府県・自治体への通知機能（要検討）

---

## 技術要件

### フロントエンド

```
Next.js 14 (App Router)
TypeScript 5.x
Tailwind CSS 3.x
Recharts 2.x（グラフ）
React Simple Maps（地図、Phase 2）
```

### バックエンド / データ

```
Supabase (PostgreSQL + REST API + Row Level Security)
Python 3.11（データ収集・前処理スクリプト）
  - openpyxl（Excel読み込み）
  - pandas（データ処理）
  - requests（一括ダウンロード）
```

### インフラ

```
Vercel（フロントエンド・API Routes）
Supabase（DB・ストレージ）
GitHub Actions（データ更新の自動化、Phase 2）
```

---

## 非機能要件

| 項目 | 要件 |
|---|---|
| レスポンス速度 | LCP < 2.5秒（Vercel Edge Cache活用） |
| データ更新頻度 | 年1回（環境省データに準拠） |
| アクセシビリティ | WCAG 2.1 AA準拠（色だけに依存しない） |
| ブラウザ対応 | Chrome/Safari/Firefox 最新版 |
| モバイル対応 | レスポンシブ（閲覧のみ） |

---

## ページルーティング

```
/                         → 国レベル（都道府県ランキング）
/[prefecture]             → 都道府県ビュー（例: /tokyo）
/[prefecture]/[city]      → 自治体詳細（例: /tokyo/nishitokyo）
```

スラッグ変換:
- 都道府県: ローマ字（`tokyo`, `osaka`, `kanagawa`）
- 自治体: 団体コード（環境省のコードをそのまま使用）または ローマ字

---

## KPI定義

| 指標名 | 定義 | 単位 |
|---|---|---|
| 総排出量 | 当該年度の合計CO₂排出量 | 千t-CO₂ |
| 削減率 | (当該年度 - 2013年度) / 2013年度 × 100 | % |
| 実績ペース | 2013年度→最新年度の年平均削減率 | %/年 |
| 必要ペース | 2030目標達成のために必要な年平均削減率 | %/年 |
| ペース達成率 | 実績ペース / 必要ペース × 100 | % |
| 不足量 | 現ペース継続時の2030年予測値 - 2030目標値 | 千t-CO₂ |
| 偏差値 | 同規模自治体内での相対位置（平均50・SD10） | - |
| 一人あたり排出量 | 総排出量 / 人口 | t-CO₂/人 |

---

## ステータス分類

| ステータス | 定義 | 色 |
|---|---|---|
| on-track | ペース達成率 ≥ 100% | 緑 |
| at-risk | ペース達成率 80–99% | 琥珀 |
| off-track | ペース達成率 < 80% | 赤 |
